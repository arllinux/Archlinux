# Après le redémarrage initial

################################################################
Note : L'utilisateur qui sera créé dans se tuto est "jpantinoux"
################################################################

Donc tout s'est bien passé et Grub etait bien configuré.

Vous voilà devant l'invite de commande :
virtualarch login :

1 - Se connecter
####~~~~~~~~~~~~#### 

Nous tapons le mon d'utilisateur :
virtualarch login : "root"
Password :
[root@virtualarch ~]#


2 - Vérifier si le service réseau fonctionne
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#### 

Vérification de la connection internet : 
# ip address show
Pas d'adress ip visible en face de enp0s3

Pour se connecter il faut faire :
# dhcpcd enp0s

Pour activer DHCP sur toutes les interfaces réseaux: 
# systemctl start dhcpcd

Activer dhcp au redémarrage
# systemctl enable dhcpcd


3 - Installer le NetworkManager
####~~~~~~~~~~~~~~~~~~~~~~~#### 

# pacman -S networkmanager
# systemctl enable NetworkManager.service

4 - Réglage du son
####~~~~~~~~~~####

# pacman -S alsa-utils alsa-oss

# alsamixer
Mettez les 2 premières colonnes au max :
Si le pied de colonne colorée contient un "M", pressez une fois la touche "m"
pour que "M" se transforme en "OO". Ensuite monter le son au maximum avec les
flèches directionnelles haut et bas.
Touche "Esc" pour quitter.

Test du son
# aplay /usr/share/sounds/alsa/*.wav

Une fois le son correctement réglé :
# alasctl store

5 - Installer le serveur graphique Xorg
###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~####

# yaourt -S xorg-server xorg-xinit xorg-xmessage xf86-input-mouse
:: Il y a 3 fournisseurs disponibles pour libgl :
:: Dépôt extra
   1) libflvnd   2) nvidia-304xx-utils   3) nvidia-340xx-utils

Entrer un nombre (par défaut, 1 est séléctionné) :

6 - VirtualBox
####~~~~~~####

Si vous installez une ArchLinux dans une machine virtuelle VirtualBox,
vous aurez une étape complémentaire pour que Xorg fonctionne correctement.
D'abord installer le paquet virtualbox-guest-utils ou virtualbox-guest-utils-lts
(si vous utilisez un noyau LTS).
# yaourt -S linux-headers
# yaourt -S virtualbox-guest-utils

Ensuite, il faut créer un fichier /etc/modules-load.d/vbox.conf qui contient les lignes suivantes :
vboxguest
vboxvideo
vboxsfnet

7 - Utilisateurs
################

Vous pouvez ajouter un utilisateur à l'aide de la commande useradd :

# useradd -g users -G users -m jpantinoux

Voyons ce que la commandde useradd a créé de manière silencieuse :
# cd /home
# ls -lh
drwx------ 2 jpantinoux users 4,0K 28 déc. 21:39 jpantinoux

La commande est beaucoup moins laxiste que sur les distributions grand public :
Seul l'utilisateur "jpantinoux" a tous les droits.
Le groupe users n'a aucun droit
Et le reste du monde non plus !

Création du mot de passe :
# passwd jpantinoux
Nouveau mot de passe :
Retapez le nouveau mot de passe :
passwd: password updated successfully

Vérifier à quel groupe appartient "jpantinoux"
# groups jpantinoux
users

Groupes
Ajouter les groupes utilisateur qui vont bien :
# usermod -aG audio,log,lp,optical,scanner,storage,video jpantinoux
Vérifications :
# groups jpantinoux
lp video storage users scanner audio log optical

On a bien tous nos groupes y compris le groupe que l'on à créé précédemmant.

Installation de la couche intermédiaire
=======================================

Dans cette partie, on va rajouter quelques outils qui sont bien pratiques.
Première couche, les greffons gstreamert
# yaourt -S gst-plugins-base gst-plugins-good gst-plugins-bad gst-plugins-ugly

On va ensuite rajouter des outils comme ntp, gimp, cups ou encore hplip
(bien pratique si vous avez une imprimante Hewlett Packard), xsane et unocov
# yaourt -S cups gimp hplip ntp xsane

Vous voulez LibreOffice et sa traduction française ?
# yaourt -S libreoffice libreoffice-fr

Pour Mozilla Firefox et sa traduction
# yaourt -S firefox-i18n-fr

Maintenant que la plus grosse partie de notre logithèque commune est installée,
nous allons activer les services communs à tous les environnements.

# systemctl enable avahi-daemon.service
# systemctl enable avahi-dnsconfd.service
# systemctl enable ntpd.service

|||||||||||||||||||||||||||||||||||||||||
2 - Installer le serveur graphique Xorg
#######################################
Installer Xfce
# yaourt -S xfce4 xfce4-goodies vlc xnoise lightdm gvfs


Tester en lancant xorg en tant que root :
Le premier lancement peut durer un bonne minute
# startxfce4
Ok

Se déconnecter
Si l'environnement de bureau se blocque, éteindre la machine


Fichier de démarrage ~/.xinitrc
Pour votre utilisateur vous aurez besoin de recopier ce fichier dans son HOME et de le modifier:

# cp /etc/X11/xinit/xinitrc ~/.xinitrc
Le principe est simple, il suffit de conserver l'ensemble de son contenu et de commenter
ou supprimer les lignes suivants twm jusqu'à la fin puis de rajouter ce dont vous avez besoin en dernier.
Par exemple :

Fichier: ~/.xinitrc

(...)

# start some nice programs
#
if [ -d /etc/X11/xinit/xinitrc.d ] ; then
for f in /etc/X11/xinit/xinitrc.d/?*.sh ; do
 [ -x "$f" ] && . "$f"
  done
  unset f
fi

#twm &
#xclock -geometry 50x50-1+1 &
#xterm -geometry 80x50+494+51 &
#xterm -geometry 80x20+494-0 &
#exec xterm -geometry 80x66+0+0 -name login
exec startxfce4-session

Se connecter en utilisteur normal
# su jpantinoux
# startxfce4
Passer au clavier français :
Applications
	Paramètres
		Clavier
			Rajouter le clavier français et supprimer anglais


3 - Gestionnaire de connexions
Installer lxdm
# pacman -S lxdm

Utilisation

Crash à la seconde déconnexion
Suite au passage à systemd, certains gestionnaires de connexion plantent lors de la deuxième déconnexion
Pour résoudre ce problème, il suffit d'ajouter une ligne à la fin du fichier de configuration approprié.

Par exemple pour LXDM:
Fichier: /etc/pam.d/lxdm
...
session 	required 	pam_systemd.so

puis activer lxde
# systemctl enable lxdm
puis
# systemctl start lxdm
Le gestionnaire se lance immédiatement.


-- Fin --
